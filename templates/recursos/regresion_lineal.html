<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Regresi√≥n Lineal - Modelo Econ√≥mico</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        .graph-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin: 20px 0;
        }
        .explanation {
            background: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 10px;
            margin: 20px 0;
            color: #333333;
            border: 2px solid #8B4513;
        }
        .explanation h2, 
        .explanation h3, 
        .explanation h4, 
        .explanation h5 {
            color: #2E8B57 !important;
        }
        .explanation p, 
        .explanation li, 
        .explanation strong {
            color: #333333 !important;
        }
        .variable-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
        }
        .regression-line {
            border-left: 3px dashed #4CAF50;
            padding-left: 15px;
            margin: 15px 0;
            background: rgba(76, 175, 80, 0.1);
            padding: 15px;
            border-radius: 8px;
        }
        
        /* Mejorar contraste del texto */
        .minecraft-main {
            color: #333333;
        }
        
        .features-section h2,
        .features-section h3,
        .features-section h4 {
            color: #2E8B57 !important;
            text-shadow: none !important;
        }
        
        .features-section p,
        .features-section li {
            color: #333333 !important;
            text-shadow: none !important;
        }
        
        /* Controles m√°s visibles */
        select, label {
            color: #333333 !important;
            font-weight: bold;
        }
        
        select {
            background: white;
            border: 2px solid #8B4513;
            padding: 8px;
            border-radius: 5px;
            width: 100%;
        }
        
        label strong {
            color: #2E8B57 !important;
        }

        /* Estilos para la secci√≥n de c√≥digo - COLORES MEJORADOS */
        .code-section {
            background: rgba(223, 82, 82, 0.95);
            padding: 25px;
            border-radius: 10px;
            margin: 20px 0;
            color: #333333;
            border: 2px solid #8B4513;
        }

        .code-container {
            background: #1e1e1e;
            color: #ea4c4c;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            position: relative;
            overflow-x: auto;
            border: 2px solid #8B4513;
        }

        .copy-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #4CAF50;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            z-index: 10;
        }

        .copy-btn:hover {
            background: #45a049;
        }

        .copy-btn.copied {
            background: #2E8B57;
        }

        pre {
            white-space: pre-wrap;
            margin: 0;
            font-size: 0.9rem;
            line-height: 1.4;
            color: #f8f8f2 !important;
        }

        code {
            color: #f8f8f2 !important;
            background: transparent !important;
        }

        /* Colores espec√≠ficos para sintaxis Python */
        .code-container .keyword { color: #ff79c6 !important; }      /* rosa para keywords */
        .code-container .string { color: #f1fa8c !important; }       /* amarillo para strings */
        .code-container .comment { color: #6272a4 !important; }      /* azul gris√°ceo para comentarios */
        .code-container .function { color: #50fa7b !important; }     /* verde para funciones */
        .code-container .number { color: #bd93f9 !important; }       /* morado para n√∫meros */
        .code-container .operator { color: #ff79c6 !important; }     /* rosa para operadores */
        .code-container .variable { color: #8be9fd !important; }     /* azul claro para variables */
    </style>
</head>
<body class="minecraft-body">
    <!-- Video de fondo - PARA TODAS LAS P√ÅGINAS -->
    <video autoplay muted loop class="video-background">
        <source src="{{ url_for('static', filename='videos/fondo.mp4') }}" type="video/mp4">
        Tu navegador no soporta videos HTML5.
    </video>
    <div class="overlay"></div>
    
    <!-- Header -->
    <header class="minecraft-header">
        <div class="header-container">
            <div class="logo-section">
                <a href="/" class="minecraft-logo">
                    <span class="logo-text">‚õè MINECONOM√çA</span>
                </a>
            </div>
            <nav class="main-nav">
                <div class="nav-section">
                    <a href="/" class="nav-item">üè† Inicio</a>
                    <a href="/regresion-lineal" class="nav-item active">üìä Regresi√≥n Lineal</a>
                </div>
            </nav>
        </div>
    </header>

    <div class="container">
        <main class="minecraft-main">
            <!-- Hero Section -->
            <section class="minecraft-hero">
                <div class="hero-content">
                    <div class="hero-text">
                        <h1 style="color: #2E8B57; text-shadow: 2px 2px 4px rgba(0,0,0,0.5);">üìà Regresi√≥n Lineal Econ√≥mica</h1>
                        <p class="hero-subtitle" style="color: #333333; font-weight: bold;">Modelando la relaci√≥n entre PIB y sus componentes</p>
                        <p style="color: #333333; font-size: 1.1rem;">An√°lisis econom√©trico: PIB vs Consumo, Inversi√≥n, Exportaciones Netas</p>
                    </div>
                </div>
            </section>

            <!-- Gr√°fica Interactiva -->
            <section class="features-section">
                <div class="section-header">
                    <h2>Modelo de Regresi√≥n Lineal: PIB y sus Componentes</h2>
                    <p>Relaci√≥n entre Producto Interno Bruto y variables macroecon√≥micas clave</p>
                </div>
                
                <div class="graph-container">
                    <div id="graficaEconomica"></div>
                </div>

                <!-- Controles Interactivos -->
                <div class="explanation">
                    <h3>üéõ Controles del Modelo Econ√≥mico</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0;">
                        <div>
                            <label><strong>Variable X:</strong></label>
                            <select id="variableX" onchange="actualizarGrafica()">
                                <option value="consumo">Consumo Privado</option>
                                <option value="inversion">Inversi√≥n</option>
                                <option value="exportaciones">Exportaciones</option>
                                <option value="importaciones">Importaciones</option>
                            </select>
                        </div>
                        <div>
                            <label><strong>Pa√≠s:</strong></label>
                            <select id="paisFiltro" onchange="actualizarGrafica()">
                                <option value="todos">Todos los pa√≠ses</option>
                                <option value="mexico">M√©xico</option>
                                <option value="usa">Estados Unidos</option>
                                <option value="china">China</option>
                                <option value="alemania">Alemania</option>
                            </select>
                        </div>
                        <div>
                            <label><strong>A√±o:</strong></label>
                            <select id="anioFiltro" onchange="actualizarGrafica()">
                                <option value="todos">Todos los a√±os</option>
                                <option value="2020">2020</option>
                                <option value="2021">2021</option>
                                <option value="2022">2022</option>
                                <option value="2023">2023</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Explicaci√≥n Econ√≥mica -->
                <div class="explanation">
                    <h3>üîç Fundamentos Econ√≥micos del Modelo</h3>
                    
                    <div class="regression-line">
                        <h4>üìê F√≥rmula de Regresi√≥n Lineal M√∫ltiple</h4>
                        <p style="color: #2E8B57 !important; font-weight: bold; font-size: 1.1rem;">
                            <strong>PIB = Œ≤‚ÇÄ + Œ≤‚ÇÅ¬∑Consumo + Œ≤‚ÇÇ¬∑Inversi√≥n + Œ≤‚ÇÉ¬∑Exportaciones + Œ≤‚ÇÑ¬∑Importaciones + Œµ</strong>
                        </p>
                    </div>

                    <div class="feature-grid">
                        <div class="feature-card">
                            <h4>üí∞ Variables del Modelo</h4>
                            <div class="variable-card">
                                <strong>PIB (Y):</strong> Variable dependiente - Producto Interno Bruto
                            </div>
                            <div class="variable-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                                <strong>Consumo (C):</strong> Gasto de hogares en bienes y servicios
                            </div>
                            <div class="variable-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                                <strong>Inversi√≥n (I):</strong> Formaci√≥n bruta de capital fijo
                            </div>
                            <div class="variable-card" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
                                <strong>Exportaciones (X):</strong> Ventas al exterior
                            </div>
                            <div class="variable-card" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
                                <strong>Importaciones (M):</strong> Compras del exterior
                            </div>
                        </div>
                        
                        <div class="feature-card">
                            <h4> Interpretaci√≥n Econ√≥mica</h4>
                            <ul style="color: #333333;">
                                <li><strong>Œ≤‚ÇÅ (Consumo):</strong> Propensi√≥n marginal a consumir</li>
                                <li><strong>Œ≤‚ÇÇ (Inversi√≥n):</strong> Multiplicador de la inversi√≥n</li>
                                <li><strong>Œ≤‚ÇÉ (Exportaciones):</strong> Efecto neto exportador</li>
                                <li><strong>Œ≤‚ÇÑ (Importaciones):</strong> Propensi√≥n marginal a importar</li>
                                <li><strong>R¬≤:</strong> Porcentaje de variaci√≥n del PIB explicado por el modelo</li>
                            </ul>
                            
                            <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin-top: 15px; color: #333333;">
                                <h5 style="color: #2E8B57;">üìà En la gr√°fica actual:</h5>
                                <p id="interpretacion" style="color: #333333;">Cargando an√°lisis...</p>
                            </div>
                        </div>
                    </div>
                </div>

            </section>

            <!--  C√≥digo Python para Replicar -->
            <section class="features-section">
                <div class="section-header">
                    <h2> C√≥digo Python para Replicar el An√°lisis</h2>
                    <p>Copia y pega este c√≥digo en tu entorno Python para obtener los mismos resultados</p>
                </div>
                
                <div class="code-section">
                    <h3> Instrucciones R√°pidas:</h3>
                    <ol style="color: #333333; margin-left: 20px;">
                        <li>Instala las dependencias: <code style="color: #2E8B57; background: #f0f0f0; padding: 2px 6px; border-radius: 3px;">pip install pandas numpy matplotlib statsmodels</code></li>
                        <li>Copia el c√≥digo siguiente</li>
                        <li>P√©galo en un archivo .py</li>
                        <li>Ejecuta y obtendr√°s la misma gr√°fica</li>
                    </ol>
                    
                    <div class="code-container">
                        <button class="copy-btn" onclick="copiarCodigo()">üìã Copiar C√≥digo</button>
                        <pre id="codigoPython"><code># AN√ÅLISIS ECONOM√âTRICO: REGRESI√ìN LINEAL M√öLTIPLE
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt

<span class="comment"># Datos econ√≥micos (los mismos que en la gr√°fica interactiva)</span>
datos_economicos = [
    <span class="comment"># M√©xico</span>
    {<span class="string">'pais'</span>: <span class="string">'M√©xico'</span>, <span class="string">'a√±o'</span>: <span class="number">2020</span>, <span class="string">'pib'</span>: <span class="number">1.09</span>, <span class="string">'consumo'</span>: <span class="number">0.68</span>, <span class="string">'inversion'</span>: <span class="number">0.25</span>, <span class="string">'exportaciones'</span>: <span class="number">0.42</span>, <span class="string">'importaciones'</span>: <span class="number">0.38</span>},
    {<span class="string">'pais'</span>: <span class="string">'M√©xico'</span>, <span class="string">'a√±o'</span>: <span class="number">2021</span>, <span class="string">'pib'</span>: <span class="number">1.27</span>, <span class="string">'consumo'</span>: <span class="number">0.79</span>, <span class="string">'inversion'</span>: <span class="number">0.28</span>, <span class="string">'exportaciones'</span>: <span class="number">0.49</span>, <span class="string">'importaciones'</span>: <span class="number">0.44</span>},
    {<span class="string">'pais'</span>: <span class="string">'M√©xico'</span>, <span class="string">'a√±o'</span>: <span class="number">2022</span>, <span class="string">'pib'</span>: <span class="number">1.41</span>, <span class="string">'consumo'</span>: <span class="number">0.88</span>, <span class="string">'inversion'</span>: <span class="number">0.31</span>, <span class="string">'exportaciones'</span>: <span class="number">0.55</span>, <span class="string">'importaciones'</span>: <span class="number">0.49</span>},
    {<span class="string">'pais'</span>: <span class="string">'M√©xico'</span>, <span class="string">'a√±o'</span>: <span class="number">2023</span>, <span class="string">'pib'</span>: <span class="number">1.52</span>, <span class="string">'consumo'</span>: <span class="number">0.95</span>, <span class="string">'inversion'</span>: <span class="number">0.34</span>, <span class="string">'exportaciones'</span>: <span class="number">0.59</span>, <span class="string">'importaciones'</span>: <span class="number">0.53</span>},
    
    <span class="comment"># USA</span>
    {<span class="string">'pais'</span>: <span class="string">'USA'</span>, <span class="string">'a√±o'</span>: <span class="number">2020</span>, <span class="string">'pib'</span>: <span class="number">21.06</span>, <span class="string">'consumo'</span>: <span class="number">14.05</span>, <span class="string">'inversion'</span>: <span class="number">3.78</span>, <span class="string">'exportaciones'</span>: <span class="number">2.13</span>, <span class="string">'importaciones'</span>: <span class="number">2.89</span>},
    {<span class="string">'pais'</span>: <span class="string">'USA'</span>, <span class="string">'a√±o'</span>: <span class="number">2021</span>, <span class="string">'pib'</span>: <span class="number">23.32</span>, <span class="string">'consumo'</span>: <span class="number">15.58</span>, <span class="string">'inversion'</span>: <span class="number">4.18</span>, <span class="string">'exportaciones'</span>: <span class="number">2.36</span>, <span class="string">'importaciones'</span>: <span class="number">3.21</span>},
    {<span class="string">'pais'</span>: <span class="string">'USA'</span>, <span class="string">'a√±o'</span>: <span class="number">2022</span>, <span class="string">'pib'</span>: <span class="number">25.44</span>, <span class="string">'consumo'</span>: <span class="number">16.98</span>, <span class="string">'inversion'</span>: <span class="number">4.56</span>, <span class="string">'exportaciones'</span>: <span class="number">2.58</span>, <span class="string">'importaciones'</span>: <span class="number">3.51</span>},
    {<span class="string">'pais'</span>: <span class="string">'USA'</span>, <span class="string">'a√±o'</span>: <span class="number">2023</span>, <span class="string">'pib'</span>: <span class="number">26.95</span>, <span class="string">'consumo'</span>: <span class="number">17.99</span>, <span class="string">'inversion'</span>: <span class="number">4.83</span>, <span class="string">'exportaciones'</span>: <span class="number">2.73</span>, <span class="string">'importaciones'</span>: <span class="number">3.72</span>},
    
    <span class="comment"># China</span>
    {<span class="string">'pais'</span>: <span class="string">'China'</span>, <span class="string">'a√±o'</span>: <span class="number">2020</span>, <span class="string">'pib'</span>: <span class="number">14.69</span>, <span class="string">'consumo'</span>: <span class="number">8.23</span>, <span class="string">'inversion'</span>: <span class="number">5.87</span>, <span class="string">'exportaciones'</span>: <span class="number">2.59</span>, <span class="string">'importaciones'</span>: <span class="number">2.18</span>},
    {<span class="string">'pais'</span>: <span class="string">'China'</span>, <span class="string">'a√±o'</span>: <span class="number">2021</span>, <span class="string">'pib'</span>: <span class="number">17.73</span>, <span class="string">'consumo'</span>: <span class="number">9.93</span>, <span class="string">'inversion'</span>: <span class="number">7.09</span>, <span class="string">'exportaciones'</span>: <span class="number">3.13</span>, <span class="string">'importaciones'</span>: <span class="number">2.63</span>},
    {<span class="string">'pais'</span>: <span class="string">'China'</span>, <span class="string">'a√±o'</span>: <span class="number">2022</span>, <span class="string">'pib'</span>: <span class="number">19.24</span>, <span class="string">'consumo'</span>: <span class="number">10.78</span>, <span class="string">'inversion'</span>: <span class="number">7.69</span>, <span class="string">'exportaciones'</span>: <span class="number">3.39</span>, <span class="string">'importaciones'</span>: <span class="number">2.85</span>},
    {<span class="string">'pais'</span>: <span class="string">'China'</span>, <span class="string">'a√±o'</span>: <span class="number">2023</span>, <span class="string">'pib'</span>: <span class="number">20.68</span>, <span class="string">'consumo'</span>: <span class="number">11.59</span>, <span class="string">'inversion'</span>: <span class="number">8.27</span>, <span class="string">'exportaciones'</span>: <span class="number">3.65</span>, <span class="string">'importaciones'</span>: <span class="number">3.07</span>},
    
    <span class="comment"># Alemania</span>
    {<span class="string">'pais'</span>: <span class="string">'Alemania'</span>, <span class="string">'a√±o'</span>: <span class="number">2020</span>, <span class="string">'pib'</span>: <span class="number">3.85</span>, <span class="string">'consumo'</span>: <span class="number">2.16</span>, <span class="string">'inversion'</span>: <span class="number">0.78</span>, <span class="string">'exportaciones'</span>: <span class="number">1.65</span>, <span class="string">'importaciones'</span>: <span class="number">1.42</span>},
    {<span class="string">'pais'</span>: <span class="string">'Alemania'</span>, <span class="string">'a√±o'</span>: <span class="number">2021</span>, <span class="string">'pib'</span>: <span class="number">4.26</span>, <span class="string">'consumo'</span>: <span class="number">2.39</span>, <span class="string">'inversion'</span>: <span class="number">0.86</span>, <span class="string">'exportaciones'</span>: <span class="number">1.82</span>, <span class="string">'importaciones'</span>: <span class="number">1.57</span>},
    {<span class="string">'pais'</span>: <span class="string">'Alemania'</span>, <span class="string">'a√±o'</span>: <span class="number">2022</span>, <span class="string">'pib'</span>: <span class="number">4.07</span>, <span class="string">'consumo'</span>: <span class="number">2.28</span>, <span class="string">'inversion'</span>: <span class="number">0.82</span>, <span class="string">'exportaciones'</span>: <span class="number">1.74</span>, <span class="string">'importaciones'</span>: <span class="number">1.50</span>},
    {<span class="string">'pais'</span>: <span class="string">'Alemania'</span>, <span class="string">'a√±o'</span>: <span class="number">2023</span>, <span class="string">'pib'</span>: <span class="number">4.31</span>, <span class="string">'consumo'</span>: <span class="number">2.42</span>, <span class="string">'inversion'</span>: <span class="number">0.87</span>, <span class="string">'exportaciones'</span>: <span class="number">1.84</span>, <span class="string">'importaciones'</span>: <span class="number">1.59</span>}
]

<span class="comment"># Convertir a DataFrame</span>
df = pd.DataFrame(datos_economicos)

print(<span class="string">"=== AN√ÅLISIS ECON√ìMICO ==="</span>)
print(<span class="string">f"Pa√≠ses analizados: <span class="variable">{df['pais'].unique().tolist()}</span>"</span>)
print(<span class="string">f"Periodo: <span class="variable">{df['a√±o'].min()}</span>-<span class="variable">{df['a√±o'].max()}</span>"</span>)
print(<span class="string">f"Total de observaciones: <span class="variable">{len(df)}</span>"</span>)

<span class="comment"># REGRESI√ìN SIMPLE: CONSUMO vs PIB</span>
print(<span class="string">"\n=== REGRESI√ìN SIMPLE ==="</span>)
X_consumo = df[<span class="string">'consumo'</span>]
y_pib = df[<span class="string">'pib'</span>]

<span class="comment"># Calcular regresi√≥n lineal manualmente</span>
n = len(X_consumo)
sum_x = sum(X_consumo)
sum_y = sum(y_pib)
sum_xy = sum(X_consumo * y_pib)
sum_x2 = sum(X_consumo ** <span class="number">2</span>)

pendiente = (n * sum_xy - sum_x * sum_y) / (n * sum_x2 - sum_x ** <span class="number">2</span>)
intercepto = (sum_y - pendiente * sum_x) / n

<span class="comment"># Calcular R-cuadrado</span>
y_pred = intercepto + pendiente * X_consumo
ss_tot = sum((y_pib - np.mean(y_pib)) ** <span class="number">2</span>)
ss_res = sum((y_pib - y_pred) ** <span class="number">2</span>)
r2_simple = <span class="number">1</span> - (ss_res / ss_tot)

print(<span class="string">f"Ecuaci√≥n: PIB = <span class="variable">{intercepto:.2f}</span> + <span class="variable">{pendiente:.2f}</span>¬∑Consumo"</span>)
print(<span class="string">f"R-cuadrado: <span class="variable">{r2_simple:.3f}</span> (<span class="variable">{r2_simple*100:.1f}</span>% de variaci√≥n explicada)"</span>)
print(<span class="string">f"Correlaci√≥n: <span class="variable">{np.corrcoef(X_consumo, y_pib)[0,1]:.3f}</span>"</span>)

<span class="comment"># CREAR GR√ÅFICA</span>
plt.figure(figsize=(<span class="number">12</span>, <span class="number">8</span>))

<span class="comment"># Colores por pa√≠s</span>
colores = {<span class="string">'M√©xico'</span>: <span class="string">'red'</span>, <span class="string">'USA'</span>: <span class="string">'blue'</span>, <span class="string">'China'</span>: <span class="string">'green'</span>, <span class="string">'Alemania'</span>: <span class="string">'orange'</span>}

<span class="comment"># Graficar puntos por pa√≠s</span>
<span class="keyword">for</span> pais <span class="keyword">in</span> df[<span class="string">'pais'</span>].unique():
    datos_pais = df[df[<span class="string">'pais'</span>] == pais]
    plt.scatter(datos_pais[<span class="string">'consumo'</span>], datos_pais[<span class="string">'pib'</span>], 
                color=colores[pais], label=pais, s=<span class="number">80</span>, alpha=<span class="number">0.7</span>)
    
    <span class="comment"># Etiquetar puntos recientes</span>
    <span class="keyword">for</span> _, fila <span class="keyword">in</span> datos_pais.iterrows():
        <span class="keyword">if</span> fila[<span class="string">'a√±o'</span>] >= <span class="number">2022</span>:
            plt.annotate(<span class="string">f"<span class="variable">{fila['pais']}</span> <span class="variable">{fila['a√±o']}</span>"</span>, 
                        (fila[<span class="string">'consumo'</span>], fila[<span class="string">'pib'</span>]),
                        xytext=(<span class="number">5</span>, <span class="number">5</span>), textcoords=<span class="string">'offset points'</span>,
                        fontsize=<span class="number">8</span>, alpha=<span class="number">0.8</span>)

<span class="comment"># L√≠nea de regresi√≥n</span>
x_range = np.linspace(df[<span class="string">'consumo'</span>].min(), df[<span class="string">'consumo'</span>].max(), <span class="number">100</span>)
plt.plot(x_range, intercepto + pendiente * x_range, 
         <span class="string">'k--'</span>, linewidth=<span class="number">2</span>, alpha=<span class="number">0.7</span>, label=<span class="string">'L√≠nea de regresi√≥n'</span>)

<span class="comment"># Personalizar gr√°fica</span>
plt.xlabel(<span class="string">'Consumo (Trillones USD)'</span>, fontsize=<span class="number">12</span>)
plt.ylabel(<span class="string">'PIB (Trillones USD)'</span>, fontsize=<span class="number">12</span>)
plt.title(<span class="string">'Relaci√≥n entre Consumo y PIB por Pa√≠s (2020-2023)'</span>, fontsize=<span class="number">14</span>, fontweight=<span class="string">'bold'</span>)
plt.legend()
plt.grid(<span class="keyword">True</span>, alpha=<span class="number">0.3</span>)

<span class="comment"># A√±adir ecuaci√≥n en la gr√°fica</span>
plt.text(<span class="number">0.05</span>, <span class="number">0.95</span>, <span class="string">f'PIB = <span class="variable">{intercepto:.2f}</span> + <span class="variable">{pendiente:.2f}</span>¬∑Consumo\nR¬≤ = <span class="variable">{r2_simple:.3f}</span>'</span>, 
         transform=plt.gca().transAxes, fontsize=<span class="number">11</span>,
         bbox=dict(boxstyle=<span class="string">"round,pad=0.3"</span>, facecolor=<span class="string">"white"</span>, alpha=<span class="number">0.8</span>))

plt.tight_layout()
plt.show()

print(<span class="string">"Gr√°fica generada"</span>)</code></pre>
                    </div>
                    
                    <div style="background: #e8f5e8; padding: 15px; border-radius: 8px; margin-top: 20px;">
                        <h4 style="color: #2E8B57;"> ¬øQu√© obtendr√°s al ejecutar este c√≥digo?</h4>
                        <ul style="color: #333333;">
                            <li><strong>La misma gr√°fica de dispersi√≥n</strong> que ves en esta p√°gina</li>
                            <li><strong>An√°lisis estad√≠stico completo</strong> de la regresi√≥n lineal</li>
                            <li><strong>Ecuaci√≥n de regresi√≥n</strong> y coeficiente de determinaci√≥n R¬≤</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- Navegaci√≥n -->
            <div style="text-align: center; margin: 40px 0;">
                <a href="/" class="nav-item" style="display: inline-block; padding: 15px 30px; background: #4CAF50; color: white; text-decoration: none; border-radius: 5px; font-weight: bold;">
                    üè† Volver al Inicio
                </a>
            </div>
        </main>
    </div>

    <footer class="minecraft-footer">
        <p>&copy; 2025 Mi P√°gina de Econom√≠a - An√°lisis Econom√©trico</p>
    </footer>

    <script>
        // Datos econ√≥micos realistas (en trillones de USD)
        const datosEconomicos = [
            // M√©xico
            { pais: 'M√©xico', a√±o: 2020, pib: 1.09, consumo: 0.68, inversion: 0.25, exportaciones: 0.42, importaciones: 0.38 },
            { pais: 'M√©xico', a√±o: 2021, pib: 1.27, consumo: 0.79, inversion: 0.28, exportaciones: 0.49, importaciones: 0.44 },
            { pais: 'M√©xico', a√±o: 2022, pib: 1.41, consumo: 0.88, inversion: 0.31, exportaciones: 0.55, importaciones: 0.49 },
            { pais: 'M√©xico', a√±o: 2023, pib: 1.52, consumo: 0.95, inversion: 0.34, exportaciones: 0.59, importaciones: 0.53 },
            
            // USA
            { pais: 'USA', a√±o: 2020, pib: 21.06, consumo: 14.05, inversion: 3.78, exportaciones: 2.13, importaciones: 2.89 },
            { pais: 'USA', a√±o: 2021, pib: 23.32, consumo: 15.58, inversion: 4.18, exportaciones: 2.36, importaciones: 3.21 },
            { pais: 'USA', a√±o: 2022, pib: 25.44, consumo: 16.98, inversion: 4.56, exportaciones: 2.58, importaciones: 3.51 },
            { pais: 'USA', a√±o: 2023, pib: 26.95, consumo: 17.99, inversion: 4.83, exportaciones: 2.73, importaciones: 3.72 },
            
            // China
            { pais: 'China', a√±o: 2020, pib: 14.69, consumo: 8.23, inversion: 5.87, exportaciones: 2.59, importaciones: 2.18 },
            { pais: 'China', a√±o: 2021, pib: 17.73, consumo: 9.93, inversion: 7.09, exportaciones: 3.13, importaciones: 2.63 },
            { pais: 'China', a√±o: 2022, pib: 19.24, consumo: 10.78, inversion: 7.69, exportaciones: 3.39, importaciones: 2.85 },
            { pais: 'China', a√±o: 2023, pib: 20.68, consumo: 11.59, inversion: 8.27, exportaciones: 3.65, importaciones: 3.07 },
            
            // Alemania
            { pais: 'Alemania', a√±o: 2020, pib: 3.85, consumo: 2.16, inversion: 0.78, exportaciones: 1.65, importaciones: 1.42 },
            { pais: 'Alemania', a√±o: 2021, pib: 4.26, consumo: 2.39, inversion: 0.86, exportaciones: 1.82, importaciones: 1.57 },
            { pais: 'Alemania', a√±o: 2022, pib: 4.07, consumo: 2.28, inversion: 0.82, exportaciones: 1.74, importaciones: 1.50 },
            { pais: 'Alemania', a√±o: 2023, pib: 4.31, consumo: 2.42, inversion: 0.87, exportaciones: 1.84, importaciones: 1.59 }
        ];

        function mostrarMensajeSinDatos() {
            const layout = {
                title: 'No hay datos disponibles',
                xaxis: { title: 'Variable X', showgrid: false, zeroline: false, showticklabels: false },
                yaxis: { title: 'PIB', showgrid: false, zeroline: false, showticklabels: false },
                plot_bgcolor: 'white',
                paper_bgcolor: 'white',
                annotations: [{
                    x: 0.5, y: 0.5, xref: 'paper', yref: 'paper',
                    text: 'No hay datos para los filtros seleccionados<br>Intenta con otras combinaciones',
                    showarrow: false,
                    font: { size: 16, color: 'red' },
                    bgcolor: 'rgba(255,255,255,0.9)',
                    bordercolor: 'red',
                    borderwidth: 2,
                    borderpad: 10
                }]
            };
            
            Plotly.newPlot('graficaEconomica', [], layout);
            
            // Actualizar interpretaci√≥n
            document.getElementById('interpretacion').innerHTML = 
                '<strong>No hay datos disponibles</strong> para los filtros seleccionados. ' +
                'Por favor, intenta con otras combinaciones de pa√≠s y a√±o.';
        }

        function getVariableNombre(variable) {
            const nombres = {
                'consumo': 'Consumo Privado',
                'inversion': 'Inversi√≥n',
                'exportaciones': 'Exportaciones',
                'importaciones': 'Importaciones'
            };
            return nombres[variable] || variable;
        }
        
        function getVariableAbrev(variable) {
            const abreviaturas = {
                'consumo': 'C',
                'inversion': 'I',
                'exportaciones': 'X',
                'importaciones': 'M'
            };
            return abreviaturas[variable] || variable;
        }

        function actualizarInterpretacion(pendiente, intercepto, rCuadrado, variableX) {
            const interpretacion = document.getElementById('interpretacion');
            const variableNombre = getVariableNombre(variableX);
            
            let texto = `
                <strong>Ecuaci√≥n estimada:</strong> PIB = ${intercepto.toFixed(2)} + ${pendiente.toFixed(2)}¬∑${getVariableAbrev(variableX)}<br><br>
                <strong>Interpretaci√≥n:</strong> Por cada $1 bill√≥n de aumento en ${variableNombre.toLowerCase()}, 
                el PIB ${pendiente > 0 ? 'aumenta' : 'disminuye'} en $${Math.abs(pendiente).toFixed(2)} billones.<br><br>
                <strong>Bondad de ajuste:</strong> R¬≤ = ${rCuadrado.toFixed(3)} (${(rCuadrado * 100).toFixed(1)}% de la variaci√≥n del PIB es explicada por ${variableNombre.toLowerCase()})
            `;
            
            interpretacion.innerHTML = texto;
        }

        function actualizarGrafica() {
            const variableX = document.getElementById('variableX').value;
            const paisFiltro = document.getElementById('paisFiltro').value;
            const anioFiltro = document.getElementById('anioFiltro').value;
            
            // Mapeo de valores del select a nombres reales
            const nombresPaises = {
                'mexico': 'M√©xico',
                'usa': 'USA', 
                'china': 'China',
                'alemania': 'Alemania'
            };
            
            // Filtrar datos - VERSI√ìN CORREGIDA
            let datosFiltrados = datosEconomicos.filter(d => {
                let cumplePais = true;
                let cumpleAnio = true;
                
                if (paisFiltro !== 'todos') {
                    cumplePais = d.pais === nombresPaises[paisFiltro];
                }
                
                if (anioFiltro !== 'todos') {
                    cumpleAnio = d.a√±o.toString() === anioFiltro;
                }
                
                return cumplePais && cumpleAnio;
            });
            
            console.log('Datos filtrados:', datosFiltrados); // Para debug
            
            // Verificar si hay datos
            if (datosFiltrados.length === 0) {
                mostrarMensajeSinDatos();
                return;
            }
            
            // Preparar datos para la gr√°fica
            const xData = datosFiltrados.map(d => d[variableX]);
            const yData = datosFiltrados.map(d => d.pib);
            const paises = datosFiltrados.map(d => d.pais);
            const a√±os = datosFiltrados.map(d => d.a√±o);
            
            // Solo calcular regresi√≥n si hay al menos 2 puntos
            if (datosFiltrados.length < 2) {
                // Mostrar solo el punto sin l√≠nea de regresi√≥n
                const trazaDatos = {
                    x: xData,
                    y: yData,
                    mode: 'markers',
                    type: 'scatter',
                    name: 'Datos',
                    marker: {
                        size: 15,
                        color: '#FF6B6B',
                        opacity: 0.8,
                        line: { width: 2, color: 'white' }
                    },
                    text: datosFiltrados.map(d => 
                        `Pa√≠s: ${d.pais}<br>A√±o: ${d.a√±o}<br>PIB: $${d.pib}T<br>${getVariableNombre(variableX)}: $${d[variableX]}T`
                    ),
                    hoverinfo: 'text'
                };
                
                const layout = {
                    title: `Relaci√≥n entre PIB y ${getVariableNombre(variableX)}`,
                    xaxis: { title: `${getVariableNombre(variableX)} (Trillones USD)` },
                    yaxis: { title: 'Producto Interno Bruto (Trillones USD)' },
                    plot_bgcolor: 'white',
                    paper_bgcolor: 'white',
                    showlegend: true,
                    annotations: [{
                        x: 0.5, y: 0.9, xref: 'paper', yref: 'paper',
                        text: 'Solo un punto disponible - No se puede calcular regresi√≥n',
                        showarrow: false,
                        bgcolor: 'rgba(255,255,255,0.8)',
                        bordercolor: 'orange',
                        borderwidth: 1
                    }]
                };
                
                Plotly.newPlot('graficaEconomica', [trazaDatos], layout);
                document.getElementById('interpretacion').innerHTML = 
                    '<strong>Un solo punto de datos:</strong> Se necesita al menos 2 puntos para calcular una regresi√≥n lineal.';
                return;
            }
            
            // Calcular l√≠nea de regresi√≥n (m√≠nimos cuadrados simples)
            const n = xData.length;
            const sumX = xData.reduce((a, b) => a + b, 0);
            const sumY = yData.reduce((a, b) => a + b, 0);
            const sumXY = xData.reduce((sum, x, i) => sum + x * yData[i], 0);
            const sumX2 = xData.reduce((sum, x) => sum + x * x, 0);
            
            const pendiente = (n * sumXY - sumX * sumY) / (n * sumX2 - sumX * sumX);
            const intercepto = (sumY - pendiente * sumX) / n;
            
            // Crear puntos para la l√≠nea de regresi√≥n
            const xMin = Math.min(...xData);
            const xMax = Math.max(...xData);
            const xLine = [xMin, xMax];
            const yLine = xLine.map(x => pendiente * x + intercepto);
            
            // Calcular R-cuadrado
            const yMean = sumY / n;
            const ssTot = yData.reduce((sum, y) => sum + Math.pow(y - yMean, 2), 0);
            const ssRes = yData.reduce((sum, y, i) => sum + Math.pow(y - (pendiente * xData[i] + intercepto), 2), 0);
            const rCuadrado = 1 - (ssRes / ssTot);
            
            // Crear trazas
            const trazaDatos = {
                x: xData,
                y: yData,
                mode: 'markers',
                type: 'scatter',
                name: 'Datos Reales',
                marker: {
                    size: 12,
                    color: a√±os.map(a√±o => {
                        const colores = {2020: '#FF6B6B', 2021: '#4ECDC4', 2022: '#45B7D1', 2023: '#96CEB4'};
                        return colores[a√±o] || '#FFA500';
                    }),
                    opacity: 0.8,
                    line: { width: 2, color: 'white' }
                },
                text: datosFiltrados.map(d => 
                    `Pa√≠s: ${d.pais}<br>A√±o: ${d.a√±o}<br>PIB: $${d.pib}T<br>${getVariableNombre(variableX)}: $${d[variableX]}T`
                ),
                hoverinfo: 'text'
            };
            
            const trazaRegresion = {
                x: xLine,
                y: yLine,
                mode: 'lines',
                type: 'scatter',
                name: `L√≠nea de Regresi√≥n (R¬≤ = ${rCuadrado.toFixed(3)})`,
                line: { color: '#FF0000', width: 3, dash: 'dash' }
            };
            
            const layout = {
                title: `Relaci√≥n entre PIB y ${getVariableNombre(variableX)}`,
                xaxis: { title: `${getVariableNombre(variableX)} (Trillones USD)` },
                yaxis: { title: 'Producto Interno Bruto (Trillones USD)' },
                plot_bgcolor: 'white',
                paper_bgcolor: 'white',
                showlegend: true,
                annotations: [{
                    x: 0.05, y: 0.95, xref: 'paper', yref: 'paper',
                    text: `Ecuaci√≥n: PIB = ${intercepto.toFixed(2)} + ${pendiente.toFixed(2)}¬∑${getVariableAbrev(variableX)}<br>R¬≤ = ${rCuadrado.toFixed(3)}`,
                    showarrow: false,
                    bgcolor: 'rgba(255,255,255,0.9)',
                    bordercolor: 'rgba(0,0,0,0.5)',
                    borderwidth: 1,
                    font: { size: 12 }
                }]
            };
            
            // Actualizar gr√°fica
            Plotly.newPlot('graficaEconomica', [trazaDatos, trazaRegresion], layout);
            
            // Actualizar interpretaci√≥n
            actualizarInterpretacion(pendiente, intercepto, rCuadrado, variableX);
        }

        // Funci√≥n para copiar el c√≥digo al portapapeles
        function copiarCodigo() {
            const codigo = document.getElementById('codigoPython').textContent;
            const boton = event.target;
            
            navigator.clipboard.writeText(codigo).then(function() {
                // Mostrar mensaje de √©xito
                boton.textContent = '‚úÖ ¬°Copiado!';
                boton.classList.add('copied');
                
                setTimeout(() => {
                    boton.textContent = 'üìã Copiar C√≥digo';
                    boton.classList.remove('copied');
                }, 2000);
            }).catch(function(err) {
                console.error('Error al copiar: ', err);
                alert('Error al copiar el c√≥digo. Puedes seleccionarlo y copiarlo manualmente.');
            });
        }
        
        // Inicializar gr√°fica
        actualizarGrafica();
    </script>
</body>
</html>